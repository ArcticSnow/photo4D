# coding :utf8

from lxml import etree
import os
import cv2 as cv


def write_S3D_xmlfile(list_pt_measures, file_name):
    """
    Write  an xml file with 3D coordinates of points, in a way that MicMac can read it
    :param list_pt_measures: list containing 3D measures in the shape :
    [[NamePt (String), coordinates (String, like 'coord1 coord2 coord3'), incertitude (String, like 'Icoord1, Icoor2, Icoord3', optional'], ...]
    :param file_name: path or name of the output file
    """
    # Creation of the document root
    measures_set = etree.Element('DicoAppuisFlottant')
    for pt in list_pt_measures:
        pt_coord = etree.SubElement(measures_set, 'OneAppuisDAF')
        # coordinates of the point
        coord_pt = etree.SubElement(pt_coord, 'Pt')
        coord_pt.text = str(pt[1])
        # name of the point
        name_pt = etree.SubElement(pt_coord, 'NamePt')
        name_pt.text = str(pt[0])
        # incertitude of the coordinates
        coord_img_pt = etree.SubElement(pt_coord, 'Incertitude')
        try:
            coord_img_pt.text = str(pt[2])
        except IndexError:
            coord_img_pt.text = "1 1 1"

        try:
            # We open the file for writing
            with open(file_name, 'w') as file:
                # Header
                file.write('<?xml version="1.0" encoding="UTF_8"?>\n')
                # Writing all the text we created
                file.write(etree.tostring(measures_set, pretty_print=True).decode('utf-8'))
        except IOError:
            print('Error while writing file')
            exit(1)


def write_S2D_xmlfile(dico_img_measures, file_name):
    """
    Write  an xml file with 2D mesures of points in different images, in a way that MicMac can read it
    :param dico_img_measures: dictionnary containing 2D measures. Must looks like :
    {NameImage1 (String) : {NamePoint1 (String) : (measureX, measureY) (tuple of float),
                           NamePoint2 (String) :  (measureX, measureY) (tuple of float), todo la doc est a continuer
                           ...},
     NameImage2 (String) : {NamePoint1 (String) : measure (String, 'coordPoint1Image2 coordPoint1Image2'),
                           NamePoint2 (String) : measure (String, 'coordPoint2Image2 coordPoint2Image2'),
                           ...}, ...}
    :param file_name: path or name of the output file
    """
    # Creation of the document root
    measures_set = etree.Element('SetOfMesureAppuisFlottants')

    print(dico_img_measures)
    for image, dico_measures in dico_img_measures.items():

        img_meas = etree.SubElement(measures_set, 'MesureAppuiFlottant1Im')
        name_img = etree.SubElement(img_meas, 'NameIm')
        name_img.text = image

        for point, measure in dico_measures.items():
            pt_mes = etree.SubElement(img_meas, 'OneMesureAF1I')
            name_pt = etree.SubElement(pt_mes, 'NamePt')
            name_pt.text = point
            coord_img_pt = etree.SubElement(pt_mes, 'PtIm')
            coord_img_pt.text = "{} {}".format(measure[0], measure[1])

    try:
        # We open the file for writing
        with open(file_name, 'w') as file:
            # Header
            file.write('<?xml version="1.0"?>\n')
            # Writing all the text we created
            file.write(etree.tostring(measures_set, pretty_print=True).decode('utf-8'))
    except IOError:
        print('Error while writing file')
        exit(1)


def write_masq_xml(tif_mask, output=""):
    """
    write  default xml file describing the mask from MicMac
    Even if this file seems useless, MicMac will throw an error without (MasqIm = Masq in the Malt command at least)
    :param tif_mask: path to the MicMac mask, in .tif format
    :param output: path for output xml file
    """
    if tif_mask.split('.')[-1] not in ["tif", "tiff"]:
        print("Wrong input path " + tif_mask + "\n Must be a .tif file")
        exit(1)
    if output == "":
        output = '.'.join(tif_mask.split('.')[:-1]) + ".xml"
    elif output.split('.')[-1] != "xml":
        print("Wrong output path " + output + "\n Must be a .xml file")
        exit(1)
    fileori = etree.Element('FileOriMnt')
    name = etree.SubElement(fileori, 'NameFileMnt')
    name.text = tif_mask
    nb_pix = etree.SubElement(fileori, 'NombrePixels')
    shape = cv.imread(  # todo on peut pas trouver plus simple ?
        tif_mask).shape
    nb_pix.text = "{} {}".format(shape[1], shape[0])
    etree.SubElement(fileori, 'OriginePlani').text = "0 0"
    res_plan = etree.SubElement(fileori, 'ResolutionPlani')
    res_plan.text = "1 1"
    or_alti = etree.SubElement(fileori, 'OrigineAlti')
    or_alti.text = "0"
    res_alti = etree.SubElement(fileori, 'ResolutionAlti')
    res_alti.text = "1"
    geom = etree.SubElement(fileori, 'Geometrie')
    geom.text = "eGeomMNTFaisceauIm1PrCh_Px1D"

    try:
        with open(output, 'w') as file:
            file.write('<?xml version="1.0" encoding="UTF_8"?>\n')
            file.write(etree.tostring(fileori, pretty_print=True).decode('utf-8'))
    except IOError:
        print('Error while writing file')
        exit(1)


def change_Ori(initial_pictures, final_pictures, ori_folder_path):
    """
    Changes all the files of an Ori- folder from MicMac, in the way that every reference to initial pictures
    is replaced by reference to final_pictures
    WARNING this will totally modify the folder without backup of the initial one, think about make a copy first
    :param initial_pictures: list of initial pictures to be replaced, in the same order as the final one
    :param final_pictures: list of initial pictures to be replaced, in the same order as the final one
    :param ori_folder_path: path of the orientation folder (name beginning with Ori- )
    """
    print(ori_folder_path)
    if ori_folder_path[-1] != '/': ori_folder_path += "/"
    if ori_folder_path.split('/')[-2][0:4] != "Ori-":
        print("Ori path is not valid : {}\nYou need to enter the path to the Ori-folder ".format(ori_folder_path))
        exit(1)
    elif len(initial_pictures) != len(final_pictures):
        print("List of input and output pictures must have the same size")
        exit(1)
    nb_pictures = len(initial_pictures)

    write_SEL_Xml(ori_folder_path + "FileImSel.xml", final_pictures)
    with open(ori_folder_path + 'Residus.xml', 'r') as file:
        filedata = file.read()
    for i in range(nb_pictures):
        # Replace the target string
        filedata = filedata.replace(initial_pictures[i], final_pictures[i])
    # Write the file out again
    with open(ori_folder_path + 'Residus.xml', 'w') as file:
        file.write(filedata)

    for j in range(nb_pictures):
        if os.path.exists(ori_folder_path + 'ImSec-{}.xml'.format(initial_pictures[j])):
            # Read in the file ImSec
            with open(ori_folder_path + 'ImSec-{}.xml'.format(initial_pictures[j]), 'r') as file:
                filedata = file.read()
            os.remove(ori_folder_path + 'ImSec-{}.xml'.format(initial_pictures[j]))
            for i in range(nb_pictures):
                # Replace the target string
                filedata = filedata.replace(initial_pictures[i], final_pictures[i])
            # Write the file out again
            with open(ori_folder_path + 'ImSec-{}.xml'.format(final_pictures[j]), 'w') as file:
                file.write(filedata)

        # rename Orientation files
        if os.path.exists(ori_folder_path + 'Orientation-{}.xml'.format(initial_pictures[j])):
            os.rename(ori_folder_path + 'Orientation-{}.xml'.format(initial_pictures[j]),
                      ori_folder_path + 'Orientation-{}.xml'.format(final_pictures[j]))

    with open(ori_folder_path + "log.txt", 'w') as log:
        log.write("This orientation was not calculated by MicMac with these pictures\n\n")
        log.write("The names of pictures were just changed \n\n")
        for i in range(nb_pictures):
            log.write("{} was replaced by {}\n".format(initial_pictures[i], final_pictures[i]))


def write_SEL_Xml(Xml_path, picture_list):
    root = etree.Element('ListOfName')
    for img in picture_list:
        name = etree.SubElement(root, 'Name')
        name.text = str(img)
    try:
        # We open the file for writing
        with open(Xml_path, 'w') as file:
            # Header
            file.write('<?xml version="1.0" encoding="UTF_8"?>\n')
            # Writing all the text we created
            file.write(etree.tostring(root, pretty_print=True).decode('utf-8'))
    except IOError:
        print('Error while writing file')
        exit(1)


def change_xml(initial_pictures, final_pictures, xml_path):
    nb_pictures = len(initial_pictures)
    # Read in the file ImSec
    with open(xml_path, 'r') as file:
        filedata = file.read()
    for i in range(nb_pictures):
        # Replace the target string
        print("remplacement de " + initial_pictures[i] + " par " + final_pictures[i])
        filedata = filedata.replace(initial_pictures[i], final_pictures[i])
    # Write the file out again
    with open(xml_path, 'w') as file:
        file.write(filedata)


def write_couples_file(file_path, master_image, pictures_list):
    """
    write an xml file for micmac command Tapioca with couples of pictures
    It works only if all pictures in pictures_list are linked to master_image
    :param file_path: path to xml file, if it already exists, it will be replaced
    :param master_image:
    :param pictures_list:
    """
    root = etree.Element('SauvegardeNamedRel')
    for img in pictures_list:
        couple = etree.SubElement(root, 'Cple')
        couple.text = str(master_image) + " " + str(img)
    with open(file_path, 'w') as xml:
        xml.write('<?xml version="1.0" encoding="UTF_8"?>\n')
        xml.write(etree.tostring(root, pretty_print=True).decode('utf-8'))


if __name__ == "__main__":
    dico = {
        'DSC02701.JPG': {'B1': (2559.8758959104671, 1950.4846272277919), 'B2': (867.56902578766653, 1147.3817668754982),
                         'GCP13': (1678.8519974712274, 1275.676695894357),
                         'GCP17': (907.82667677805, 1195.7559666697266),
                         'GCP18': (2539.4998868108223, 1312.4937349209911),
                         'GCP21': (2951.9539767813317, 1285.130536156822),
                         'GCP28': (4298.8434223717013, 1295.4885053562984),
                         'GCP30': (3751.6863206530279, 1341.7791227136113),
                         'GCP34': (3778.9629789089176, 1437.1090449994822),
                         'GCP4': (4952.0214442997867, 1383.5322719261758),
                         'GCP6': (3101.4399888875259, 1678.1009608833151),
                         'GCP7bis': (2784.6166419621541, 1720.5198165031647)},
        'DSC02749.JPG': {'B1': (2560.1488959104672, 1948.2676272277922), 'B2': (871.67167578766657, 1144.0923668754981),
                         'GCP13': (1678.8709974712274, 1272.117695894357),
                         'GCP17': (887.84417677805004, 1198.1620666697265),
                         'GCP18': (2539.5868868108223, 1309.0787349209911),
                         'GCP21': (2952.1569767813317, 1281.804536156822),
                         'GCP28': (4342.5644223717018, 1310.8564053562984),
                         'GCP30': (3751.5394206530277, 1338.3911227136111),
                         'GCP34': (3778.9059289089173, 1433.7035949994822),
                         'GCP4': (4952.0549442997872, 1380.8317719261759),
                         'GCP6': (3101.3619888875264, 1674.854960883315),
                         'GCP7bis': (2798.9626419621541, 1699.7008165031646),
                         'GCP8': (2550.0774843272447, 1623.6907382928448)},
        'DSC02773.JPG': {'B1': (2562.5323959104671, 1951.6856272277923), 'B2': (871.48067578766666, 1139.8237168754981),
                         'GCP13': (1679.3349974712276, 1270.192695894357),
                         'GCP17': (908.11937677804985, 1190.4544666697266),
                         'GCP18': (2540.1218868108222, 1307.4527349209911),
                         'GCP21': (2952.9649767813321, 1280.2255361568218),
                         'GCP28': (4343.0989223717015, 1308.8991053562984),
                         'GCP30': (3752.4545206530279, 1336.934122713611),
                         'GCP34': (3779.7060289089177, 1432.2135949994822),
                         'GCP4': (4952.9344442997863, 1379.2102719261759),
                         'GCP6': (3102.015988887526, 1673.009960883315),
                         'GCP7bis': (2770.697341962154, 1706.8348165031646)},
        'DSC02797.JPG': {'B1': (2561.5378959104673, 1951.0641272277924),
                         'GCP13': (1679.4589974712276, 1268.6696958943569),
                         'GCP18': (2498.4828868108225, 1309.3107349209911),
                         'GCP21': (2938.816976781332, 1269.296536156822),
                         'GCP28': (4343.1699223717014, 1307.9065053562986),
                         'GCP35': (3532.8751191125771, 1700.3143012017003),
                         'GCP4': (4952.7689442997871, 1378.7667719261758),
                         'GCP6': (3101.8109888875265, 1671.9829608833152),
                         'GCP8': (2586.3994843272444, 1592.025038292845)},
        'DSC02821.JPG': {'B1': (2561.1733959104672, 1948.4016272277922), 'B2': (867.52867578766654, 1138.6030168754983),
                         'GCP13': (1678.3789974712274, 1266.8526958943571),
                         'GCP17': (919.11102677805002, 1195.7404666697266),
                         'GCP18': (2539.5828868108224, 1303.9727349209911),
                         'GCP21': (2952.1889767813318, 1276.996536156822),
                         'GCP28': (4342.8241723717019, 1306.2016053562984),
                         'GCP30': (3751.8868206530278, 1333.751122713611),
                         'GCP34': (3779.1055789089178, 1429.1310949994822),
                         'GCP4': (4952.2784442997872, 1376.6232719261757),
                         'GCP6': (3101.3929888875264, 1669.7469608833151),
                         'GCP7bis': (2774.763641962154, 1703.2768165031646),
                         'GCP8': (2557.0436843272446, 1586.064038292845)},
        'DSC02845.JPG': {'B1': (2559.1903959104675, 1949.2971272277923), 'B2': (864.36017578766655, 1137.6567668754981),
                         'GCP13': (1676.1159974712273, 1266.596695894357),
                         'GCP17': (904.59567677804989, 1186.1424666697267),
                         'GCP18': (2536.9873868108225, 1304.0152349209911),
                         'GCP21': (2949.8436267813317, 1276.9600361568218),
                         'GCP28': (4340.2144223717023, 1306.4670053562986),
                         'GCP30': (3749.5738206530277, 1334.0036227136111),
                         'GCP34': (3776.4083389089178, 1429.5111949994823),
                         'GCP4': (4949.7539442997868, 1376.8427719261758),
                         'GCP6': (3098.9239888875263, 1670.046960883315)},
        'DSC02869.JPG': {'B1': (2558.7663959104671, 1946.7146272277923), 'B2': (864.83767578766663, 1135.9487668754982),
                         'GCP13': (1675.9609974712275, 1264.480695894357),
                         'GCP18': (2537.1108868108222, 1301.6082349209912),
                         'GCP21': (2949.689976781332, 1274.7685361568219),
                         'GCP28': (4339.8389223717013, 1303.6984553562984),
                         'GCP30': (3749.5992206530277, 1331.3211227136112),
                         'GCP34': (3776.6155289089174, 1426.7835949994821),
                         'GCP4': (4949.2524442997874, 1374.2427719261757),
                         'GCP6': (3098.7314888875262, 1667.515460883315),
                         'GCP7bis': (2788.2757419621539, 1704.8508165031647)},
        'DSC02893.JPG': {'B1': (2558.7783959104672, 1944.679627227792), 'B2': (864.2770757876666, 1133.7717668754981),
                         'GCP13': (1675.8029974712274, 1262.1686958943569),
                         'GCP17': (903.19817677804997, 1181.2844666697267),
                         'GCP18': (2537.0093868108224, 1299.4897349209912),
                         'GCP21': (2950.133976781332, 1268.4595361568222),
                         'GCP28': (4339.6484223717016, 1301.3960053562987),
                         'GCP30': (3749.3203206530279, 1329.056622713611),
                         'GCP34': (3776.6493289089176, 1424.4302449994823),
                         'GCP4': (4949.5529442997868, 1371.8652719261759),
                         'GCP6': (3098.821988887526, 1665.2359608833149),
                         'GCP7bis': (2780.5392919621536, 1703.4523165031646),
                         'GCP8': (2573.2874843272443, 1580.8990382928448)},
        'DSC02917.JPG': {'B1': (2558.3623959104671, 1943.0816272277921), 'B2': (863.2996757876665, 1132.404266875498),
                         'GCP13': (1675.1101974712274, 1260.7141958943571),
                         'GCP17': (879.10517677804978, 1178.3577666697265),
                         'GCP18': (2536.1293868108223, 1297.9202349209913),
                         'GCP21': (2948.9529767813319, 1270.948536156822),
                         'GCP28': (4339.3984223717016, 1299.5434553562986),
                         'GCP30': (3748.3732706530282, 1327.728622713611),
                         'GCP34': (3776.0074789089176, 1423.0390949994821),
                         'GCP35': (3557.7261191125772, 1690.1563012017002),
                         'GCP4': (4948.7589442997869, 1369.8877719261757),
                         'GCP6': (3097.9779888875264, 1663.9079608833149),
                         'GCP7bis': (2785.588741962154, 1702.4658165031647),
                         'GCP8': (2571.7894843272443, 1580.8740382928449)},
        'DSC02941.JPG': {'B1': (2555.2803959104672, 1943.9041272277923), 'B2': (860.34927578766656, 1133.0002668754983),
                         'GCP13': (1671.7404974712274, 1261.4331958943571),
                         'GCP17': (899.98657677804999, 1182.0454666697265),
                         'GCP18': (2532.5018868108223, 1298.5847349209912),
                         'GCP21': (2945.6819767813322, 1271.482036156822),
                         'GCP28': (4335.8429223717012, 1299.5231553562985),
                         'GCP30': (3745.303070653028, 1328.2771227136111),
                         'GCP34': (3772.4566789089176, 1423.4988449994821),
                         'GCP35': (3555.7911191125772, 1687.8213012017002),
                         'GCP4': (4944.8299442997868, 1370.5562719261759),
                         'GCP6': (3095.0044888875263, 1664.2474608833149),
                         'GCP7bis': (2772.415641962154, 1703.8448165031646),
                         'GCP8': (2566.5444843272444, 1582.0520382928448)},
        'DSC02965.JPG': {'B1': (2553.797395910467, 1941.6666272277921), 'B2': (858.87822578766657, 1131.048016875498),
                         'GCP13': (1670.6034974712275, 1259.5701958943569),
                         'GCP17': (897.14462677805, 1177.3079666697267),
                         'GCP18': (2531.9738868108225, 1296.8632349209911),
                         'GCP21': (2944.2179767813318, 1269.315536156822),
                         'GCP28': (4334.9034223717008, 1298.2480553562987),
                         'GCP30': (3744.1153706530276, 1326.494122713611),
                         'GCP34': (3771.4396789089174, 1421.7579949994824),
                         'GCP35': (3556.6471191125775, 1687.5043012017002),
                         'GCP4': (4943.6669442997863, 1369.182771926176),
                         'GCP6': (3093.3379888875261, 1661.440960883315),
                         'GCP8': (2563.9184843272446, 1581.334038292845)},
        'DSC02989.JPG': {'B1': (2555.7873959104668, 1940.882627227792), 'B2': (860.82032578766666, 1128.7472668754981),
                         'GCP13': (1672.1859974712274, 1258.4041958943571),
                         'GCP17': (900.54217677804991, 1179.0294666697266),
                         'GCP18': (2533.7863868108225, 1295.5097349209911),
                         'GCP21': (2946.6999767813322, 1268.259036156822),
                         'GCP28': (4336.5894223717014, 1296.9348553562986),
                         'GCP30': (3746.0903206530274, 1325.0676227136109),
                         'GCP34': (3773.4109289089174, 1420.4725949994822),
                         'GCP35': (3555.2791191125771, 1684.7373012017003),
                         'GCP4': (4946.0734442997873, 1367.3987719261759),
                         'GCP6': (3095.5694888875259, 1661.142960883315),
                         'GCP7bis': (2771.3907919621543, 1706.8523165031647),
                         'GCP8': (2558.4134843272445, 1584.9565382928449)},
        'DSC03013.JPG': {'B1': (2555.5348959104667, 1939.3831272277921), 'B2': (860.62367578766657, 1129.0169168754981),
                         'GCP13': (1672.2769974712273, 1257.357695894357),
                         'GCP17': (899.39941177804997, 1176.8929666697268),
                         'GCP18': (2533.7108868108226, 1294.110734920991),
                         'GCP21': (2946.6064767813323, 1266.9575361568218),
                         'GCP28': (4334.9784223717015, 1294.8338053562984),
                         'GCP30': (3745.9603206530282, 1323.7771227136111),
                         'GCP34': (3773.284428908918, 1419.0847449994822),
                         'GCP35': (3554.5631191125772, 1686.1823012017003),
                         'GCP4': (4946.0454442997871, 1365.9707719261758),
                         'GCP6': (3095.4902888875263, 1659.9879608833148),
                         'GCP7bis': (2771.300041962154, 1705.4768165031646),
                         'GCP8': (2560.7569843272445, 1583.6425382928451)},
        'DSC03037.JPG': {'B1': (2555.1158959104669, 1939.1486272277921), 'B2': (859.82467578766659, 1128.6458668754981),
                         'GCP13': (1671.7037474712274, 1256.825195894357),
                         'GCP17': (899.24292677804999, 1176.9979666697268),
                         'GCP18': (2532.6913868108222, 1293.780234920991),
                         'GCP21': (2945.700976781332, 1266.7635361568218),
                         'GCP28': (4333.8839223717023, 1293.6050053562985),
                         'GCP30': (3745.5323206530279, 1323.2246227136111),
                         'GCP34': (3772.8449289089176, 1418.3920449994821),
                         'GCP35': (3554.5901191125772, 1684.5198012017004),
                         'GCP4': (4945.5509442997864, 1365.5237719261759),
                         'GCP6': (3094.9529888875263, 1659.356960883315),
                         'GCP7bis': (2770.5016419621543, 1705.1928165031647),
                         'GCP8': (2557.4654843272442, 1583.1100382928448)},
        'DSC03061.JPG': {'B1': (2555.5588959104671, 1938.3116272277921), 'B2': (861.16217578766657, 1128.1505168754982),
                         'GCP13': (1672.2984974712274, 1256.1786958943571),
                         'GCP17': (901.19417677804995, 1176.9449666697265),
                         'GCP18': (2533.5688868108223, 1293.1372349209912),
                         'GCP21': (2945.8984767813317, 1266.097036156822),
                         'GCP28': (4335.0679223717016, 1293.2245053562986),
                         'GCP30': (3746.1943206530277, 1322.713122713611),
                         'GCP34': (3773.306428908918, 1417.9009949994822),
                         'GCP35': (3556.1886191125773, 1684.4713012017003),
                         'GCP4': (4946.2464442997871, 1365.0147719261759),
                         'GCP6': (3095.7319888875263, 1658.7429608833149),
                         'GCP7bis': (2771.0106919621539, 1703.0345165031647),
                         'GCP8': (2556.9404843272446, 1581.6105382928449)},
        'DSC03085.JPG': {'B1': (2555.8808959104672, 1937.9496272277925), 'B2': (861.07812578766652, 1128.057266875498),
                         'GCP13': (1672.4094974712273, 1256.4131958943572),
                         'GCP17': (901.29272677805, 1176.9848166697266),
                         'GCP18': (2533.9253868108226, 1293.1997349209912),
                         'GCP21': (2946.6554767813323, 1265.8765361568219),
                         'GCP28': (4335.1044223717017, 1294.0255053562985),
                         'GCP30': (3745.9063206530282, 1322.369122713611),
                         'GCP34': (3771.5349289089172, 1417.6440949994821),
                         'GCP35': (3555.7416191125772, 1684.6543012017003),
                         'GCP4': (4946.4864442997878, 1364.8297719261759),
                         'GCP6': (3094.7629888875263, 1658.4009608833151),
                         'GCP7bis': (2771.9226419621536, 1703.9898165031645),
                         'GCP8': (2557.8819843272445, 1581.910038292845)},
        'DSC03109.JPG': {'B1': (2556.0818959104672, 1938.7871272277923), 'B2': (861.38717578766659, 1128.7837668754983),
                         'GCP13': (1672.7534974712273, 1256.9766958943569),
                         'GCP17': (900.97367677804982, 1177.1734666697266),
                         'GCP18': (2534.0348868108222, 1293.587234920991),
                         'GCP21': (2946.5954767813319, 1266.4990361568221),
                         'GCP28': (4337.1119223717014, 1294.8965053562986),
                         'GCP30': (3746.6048206530277, 1322.7636227136111),
                         'GCP34': (3771.2839289089179, 1417.7605949994822),
                         'GCP35': (3555.6016191125773, 1685.6578012017003),
                         'GCP4': (4946.446944299787, 1365.265271926176),
                         'GCP6': (3096.152488887526, 1659.3409608833149),
                         'GCP7bis': (2772.2231419621539, 1704.9558165031647),
                         'GCP8': (2558.9829843272446, 1583.0980382928451)},
        'DSC03157.JPG': {'B1': (2556.308395910467, 1939.2111272277925), 'B2': (861.45667578766654, 1129.4572668754981),
                         'GCP13': (1672.7224974712274, 1257.4491958943572),
                         'GCP17': (900.96667677804999, 1177.9507166697267),
                         'GCP18': (2534.0558868108224, 1294.2642349209909),
                         'GCP21': (2946.832976781332, 1267.173036156822),
                         'GCP28': (4337.2669223717021, 1295.7655053562985),
                         'GCP30': (3746.9453206530279, 1323.4151227136113),
                         'GCP34': (3773.9203289089173, 1418.7820949994821),
                         'GCP35': (3555.5231191125768, 1686.9383012017001),
                         'GCP4': (4946.3389442997868, 1365.5412719261758),
                         'GCP6': (3095.7709888875261, 1660.231960883315),
                         'GCP7bis': (2772.1001419621539, 1705.8293165031646),
                         'GCP8': (2557.7084843272442, 1584.151038292845)},
        'DSC03181.JPG': {'B1': (2557.0373959104672, 1939.2101272277923), 'B2': (861.72317578766661, 1130.4397668754982),
                         'GCP13': (1673.3804974712275, 1257.5086958943571),
                         'GCP17': (901.5521767780499, 1178.8619666697268),
                         'GCP18': (2534.5408868108225, 1294.0662349209911),
                         'GCP21': (2947.0664767813323, 1266.5915361568218),
                         'GCP28': (4338.2474223717018, 1296.0905053562985),
                         'GCP30': (3746.9998206530277, 1323.1566227136111),
                         'GCP34': (3774.1789289089174, 1418.3192449994822),
                         'GCP35': (3556.0406191125767, 1686.7448012017003),
                         'GCP4': (4947.1059442997866, 1365.0122719261758),
                         'GCP6': (3096.6794888875265, 1659.6284608833153),
                         'GCP7bis': (2772.2257419621537, 1706.5568165031646),
                         'GCP8': (2560.3134843272446, 1584.5960382928449)},
        'DSC03205.JPG': {'B1': (2556.9953959104669, 1938.9276272277921), 'B2': (861.74317578766659, 1129.1024668754981),
                         'GCP13': (1673.2294974712272, 1257.387695894357),
                         'GCP17': (901.90057677804998, 1178.1684666697265),
                         'GCP18': (2534.4678868108222, 1294.0037349209911),
                         'GCP21': (2947.832976781332, 1266.8230361568221),
                         'GCP28': (4338.279422371701, 1295.9515053562986),
                         'GCP30': (3747.2409206530278, 1323.3971227136112),
                         'GCP34': (3774.7489289089176, 1418.5765949994823),
                         'GCP35': (3555.7576191125772, 1687.7373012017001),
                         'GCP4': (4947.1374442997867, 1365.4652719261758),
                         'GCP6': (3096.4719888875261, 1659.705460883315),
                         'GCP7bis': (2772.4975919621538, 1705.5373165031647),
                         'GCP8': (2557.9479843272443, 1586.693538292845)},
        'DSC03229.JPG': {'B1': (2557.2253959104673, 1938.8056272277922), 'B2': (862.32767578766652, 1130.3620168754981),
                         'GCP13': (1673.6444974712272, 1257.2666958943569),
                         'GCP17': (903.47317677804995, 1178.9014666697267),
                         'GCP18': (2535.0693868108219, 1293.9627349209911),
                         'GCP21': (2947.4944767813322, 1266.3030361568221),
                         'GCP28': (4338.8114223717021, 1297.4085053562985),
                         'GCP30': (3747.5013206530284, 1323.137122713611),
                         'GCP34': (3774.8544289089177, 1418.3471949994823),
                         'GCP35': (3555.6056191125772, 1686.7468012017002),
                         'GCP4': (4947.6939442997864, 1365.3642719261757),
                         'GCP6': (3096.9389888875262, 1659.305960883315),
                         'GCP7bis': (2772.8212419621541, 1705.3338165031646),
                         'GCP8': (2559.5691843272443, 1583.3210382928451)},
        'DSC03253.JPG': {'B1': (2557.625395910467, 1938.4561272277924), 'B2': (862.32767578766675, 1128.3304668754981),
                         'GCP13': (1673.8729974712273, 1257.0595958943568),
                         'GCP18': (2534.5083868108222, 1294.3797349209913),
                         'GCP21': (2948.537976781332, 1266.3705361568218),
                         'GCP28': (4339.4479223717008, 1297.9752553562985),
                         'GCP30': (3747.704820653028, 1323.0046227136111),
                         'GCP34': (3775.0931889089175, 1418.3024949994822),
                         'GCP35': (3554.1321191125771, 1687.5413012017002),
                         'GCP4': (4947.723944299787, 1365.173771926176),
                         'GCP6': (3097.140988887526, 1659.3849608833152),
                         'GCP7bis': (2773.1554419621539, 1705.0828165031648),
                         'GCP8': (2559.9044843272445, 1583.4310382928447)},
        'DSC03277.JPG': {'B1': (2557.0523959104667, 1939.0876272277924), 'B2': (862.02067578766662, 1129.3729668754982),
                         'GCP13': (1674.2459974712274, 1257.5286958943568),
                         'GCP18': (2534.5763868108224, 1294.4212349209911),
                         'GCP21': (2948.0399767813324, 1267.0785361568219),
                         'GCP28': (4338.2361723717013, 1295.7661053562986),
                         'GCP30': (3747.2563206530281, 1323.7191227136111),
                         'GCP34': (3774.7072289089174, 1418.9750449994822),
                         'GCP35': (3552.5101191125768, 1689.6403012017004),
                         'GCP4': (4947.5459442997872, 1365.8917719261758),
                         'GCP6': (3097.3359888875261, 1660.2874608833149),
                         'GCP7bis': (2787.467091962154, 1698.8748165031648),
                         'GCP8': (2559.4694843272446, 1583.8300382928451)},
        'DSC03301.JPG': {'B1': (2557.6493959104673, 1939.2661272277921), 'B2': (863.27567578766661, 1130.643366875498),
                         'GCP13': (1674.6909974712273, 1257.498195894357),
                         'GCP17': (892.84267677804996, 1181.9987616697267),
                         'GCP18': (2535.8268868108225, 1294.2567349209912),
                         'GCP21': (2948.4776267813322, 1266.938536156822),
                         'GCP28': (4339.2918223717024, 1295.6967053562985),
                         'GCP30': (3748.2597206530281, 1323.7056227136109),
                         'GCP34': (3775.4619789089174, 1419.0856449994822),
                         'GCP35': (3557.1351191125773, 1686.6658012017001),
                         'GCP4': (4948.674444299787, 1366.0892719261758),
                         'GCP6': (3097.9854888875261, 1660.0774608833149),
                         'GCP7bis': (2773.5613919621537, 1705.7973165031647),
                         'GCP8': (2560.6464843272443, 1583.450038292845)},
        'DSC03325.JPG': {'B1': (2558.004895910467, 1938.9146272277924), 'B2': (862.8916757876666, 1130.674166875498),
                         'GCP13': (1674.2539974712272, 1257.2946958943571),
                         'GCP17': (905.61417677805002, 1180.0268666697266),
                         'GCP18': (2535.9398868108219, 1294.110734920991),
                         'GCP21': (2948.6939767813319, 1266.6555361568221),
                         'GCP28': (4339.2600723717023, 1295.8042553562984),
                         'GCP30': (3748.1610206530281, 1323.5506227136111),
                         'GCP34': (3775.6344289089175, 1418.5889949994823),
                         'GCP35': (3557.3561191125773, 1686.4698012017002),
                         'GCP4': (4948.6749442997861, 1365.7367719261758),
                         'GCP6': (3123.9349888875258, 1624.287960883315),
                         'GCP7bis': (2773.6221419621538, 1705.4853165031648),
                         'GCP8': (2543.9369843272443, 1612.2410382928451)},
        'DSC03349.JPG': {'B1': (2557.810895910467, 1938.9021272277921),
                         'GCP13': (1674.6532974712275, 1257.0666958943571),
                         'GCP17': (876.57457677804996, 1187.6934666697266),
                         'GCP18': (2535.8883868108223, 1294.0737349209912),
                         'GCP21': (2948.863976781332, 1266.6540361568218),
                         'GCP28': (4339.4020723717022, 1295.3665053562986),
                         'GCP30': (3748.417270653028, 1323.4036227136112),
                         'GCP34': (3775.8496289089176, 1418.4735949994822),
                         'GCP35': (3557.7176191125773, 1686.6088012017003),
                         'GCP4': (4948.6459442997866, 1365.7907719261757),
                         'GCP6': (3098.2719888875263, 1659.3864608833148)},
        'DSC03373.JPG': {'B1': (2557.7518959104668, 1939.0371272277921), 'B2': (858.75917578766666, 1131.7132168754981),
                         'GCP13': (1675.1949974712275, 1257.769695894357),
                         'GCP17': (872.31417677805007, 1173.7414866697266),
                         'GCP18': (2535.7558868108226, 1294.1392349209912),
                         'GCP21': (2948.4472767813322, 1266.8495361568218),
                         'GCP28': (4338.8429223717012, 1295.5918553562985),
                         'GCP30': (3748.0524206530281, 1323.676122713611),
                         'GCP34': (3775.2939289089172, 1418.7240949994821),
                         'GCP35': (3557.0451191125767, 1686.4873012017001),
                         'GCP4': (4948.2964442997873, 1365.6972719261757),
                         'GCP6': (3102.7494888875262, 1667.013460883315),
                         'GCP8': (2539.1794843272442, 1574.283038292845)},
        'DSC03397.JPG': {'B1': (2557.692395910467, 1938.8581272277922), 'B2': (832.42767578766654, 1124.1275668754981),
                         'GCP13': (1671.4209974712273, 1269.2881958943572),
                         'GCP18': (2535.8838868108223, 1294.0867349209911),
                         'GCP21': (2948.7764767813319, 1266.4500361568221),
                         'GCP28': (4339.2910723717014, 1294.9093553562984),
                         'GCP30': (3748.1805706530276, 1323.213122713611),
                         'GCP34': (3775.6470289089175, 1418.4820449994822),
                         'GCP35': (3555.812119112577, 1685.9043012017003),
                         'GCP4': (4948.6089442997873, 1365.6602719261757),
                         'GCP6': (3092.573988887526, 1695.3909608833151),
                         'GCP7bis': (2773.3656419621539, 1705.3790165031646),
                         'GCP8': (2538.7354843272442, 1574.017038292845)},
        'DSC03421.JPG': {'B1': (2558.5208959104671, 1938.4911272277923), 'B2': (863.0533757876666, 1128.565466875498),
                         'GCP17': (930.98717677804996, 1191.8724666697267),
                         'GCP18': (2536.3083868108224, 1293.7057349209913),
                         'GCP21': (2949.4919767813317, 1266.361536156822),
                         'GCP28': (4339.7118723717012, 1294.8455053562984),
                         'GCP30': (3748.6963206530281, 1323.0196227136112),
                         'GCP34': (3776.0695289089176, 1418.2505949994822),
                         'GCP35': (3557.8916191125772, 1686.1273012017002),
                         'GCP4': (4948.9884442997864, 1365.2287719261758),
                         'GCP7bis': (2773.3966419621538, 1705.2288165031646)},
        'DSC03445.JPG': {'B1': (2557.9933959104674, 1938.7581272277921), 'B2': (862.41327578766663, 1128.6117668754982),
                         'GCP13': (1690.2957474712275, 1264.6559958943571),
                         'GCP18': (2535.6938868108223, 1294.071734920991),
                         'GCP21': (2948.406476781332, 1266.7445361568221),
                         'GCP28': (4339.3200723717018, 1295.0590053562985),
                         'GCP30': (3748.043170653028, 1323.2831227136112),
                         'GCP34': (3775.4908289089176, 1418.4445949994822),
                         'GCP35': (3557.4391191125769, 1686.2793012017003),
                         'GCP4': (4948.3139442997872, 1365.5642719261757),
                         'GCP6': (3098.5549888875257, 1659.872960883315),
                         'GCP8': (2529.1234843272446, 1572.5410382928449)},
        'DSC03469.JPG': {'B1': (2561.0303959104672, 1938.5786272277921),
                         'GCP13': (1677.3204974712273, 1257.1866958943569),
                         'GCP17': (918.46017677805003, 1197.4814666697266),
                         'GCP18': (2538.6193868108221, 1293.5777349209911),
                         'GCP21': (2951.7509767813317, 1266.152536156822),
                         'GCP28': (4342.0884223717012, 1293.9483053562985),
                         'GCP30': (3750.952320653028, 1322.3281227136113),
                         'GCP34': (3778.4700789089175, 1417.8217949994821),
                         'GCP35': (3560.2281191125771, 1686.1243012017003),
                         'GCP4': (4951.8403442997869, 1364.2212719261759),
                         'GCP8': (2562.9359343272445, 1582.7665382928449)},
        'DSC03493.JPG': {'B1': (2561.303895910467, 1938.0271272277923), 'B2': (852.51097578766667, 1122.4977668754982),
                         'GCP13': (1677.5299974712273, 1256.5926958943569),
                         'GCP18': (2538.7243868108221, 1293.1832349209913),
                         'GCP21': (2951.962476781332, 1265.445036156822),
                         'GCP28': (4342.678072371702, 1293.6770553562985),
                         'GCP30': (3751.1763206530281, 1321.896122713611),
                         'GCP34': (3778.6754789089173, 1417.1855949994824),
                         'GCP35': (3560.4031191125773, 1684.9063012017002),
                         'GCP4': (4952.111944299786, 1363.807771926176),
                         'GCP7bis': (2773.408641962154, 1704.5708165031647)}}

    write_S2D_xmlfile(dico, 'All_gcp-S2D.xml')

    liste_points3D = [['1', "-23.4605861800590318 1.71111440194407338 26.4778679705422384", "1 1 1"],
                      ['1', "15.9331147514487199 -5.33682558320814415 102.277413480224084"]]

    # write_masq_xml(
    #    "C:/Users/Alexis/Documents/Travail/Stage_Oslo/Grandeurnature/Result_guillaume/20170614/DSC00333_Masq.tif",
    #    output="C:/Users/Alexis/Documents/Travail/Stage_Oslo/Grandeurnature/Result_guillaume/20170612/DSC00333_Masq.xml")
